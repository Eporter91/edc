/*!CK:1131087754!*//*1434938826,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["EfJl2"]); }

__d("FaceboxSourceConstants",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={SNOWLIFT_SUGGEST:"snowlift_suggest",SNOWLIFT_DISMISS:"photo_snowlift_unit_suggestions",PERMALINK_SUGGEST:"permalink_suggest",PERMALINK_DISMISS:"photo_permalink_suggestions",UPLOADER_SUGGEST:"uploader_suggest",UPLOADER_DISMISS:"album_uploader_suggestions"};},null);
__d("PhotoTagApproval",["Arbiter","CSS","DOM","Event","Parent","PhotosConst","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();function n(o){"use strict";this.viewer=o;this.units=[];this.currentUnit=0;var p=o.getVersionConst();if(p==l.VIEWER_SNOWLIFT){this._root=m('fbPhotoSnowliftTagApproval');}else this._root=m('fbPhotoPageTagApproval');g.subscribe(o.getEventString('DATA_CHANGE'),this.restartTagApproval.bind(this));g.subscribe('PhotoTagApproval.PENDING_TAG_PHOTO_CLICK',this.pendingTagPhotoClick.bind(this));j.listen(this._root,'click',this.handleClick.bind(this));j.listen(this._root,'mousemove',function(q){this.hiliteCurrentPendingTag();j.kill(q);}.bind(this));this.restartTagApproval();}n.prototype.handleClick=function(event){"use strict";var o=event.getTarget();if(h.hasClass(o,'nextPager')&&h.hasClass(o,'enabled')){this.showNextUnit();}else if(h.hasClass(o,'prevPager')&&h.hasClass(o,'enabled')){this.showPrevUnit();}else if(k.byClass(o,'fbPhotoApprovalPendingButtons')){var p=this.units[this.currentUnit],q=this.getTagNameID(p);if(q){var r=k.byClass(o,'approve');g.inform('PhotoTagApproval.UPDATE_TAG_BOX',{id:q,approve:r,version:this.viewer.getVersionConst()});}setTimeout(this.removeSelectedUnit.bind(this),0);}return true;};n.prototype.loadUnits=function(o){"use strict";this.units=i.scry(this._root,'div.fbPhotoApprovalUnit');if(this.units.length){h.show(this._root);this.showUnit(o);h.conditionClass(this._root,'hidePagers',this.units.length==1);}else{h.hide(this._root);g.inform('PhotoTagApproval.HILITE_TAG',{tag:null,version:this.viewer.getVersionConst()});}};n.prototype.restartTagApproval=function(){"use strict";this.loadUnits(0);};n.prototype.pendingTagPhotoClick=function(o,p){"use strict";if(p.version!==l.VIEWER_PERMALINK&&p.version!==l.VIEWER_SNOWLIFT)return true;var q='approve:'+p.id;for(var r=0;r<this.units.length;r++)if(this.units[r].id===q){this.showUnit(r);return false;}return true;};n.prototype.removeSelectedUnit=function(){"use strict";var o=this.units[this.currentUnit];i.remove(o);this.loadUnits(this.currentUnit);};n.prototype.showNextUnit=function(){"use strict";this.showUnit(this.currentUnit+1);};n.prototype.showPrevUnit=function(){"use strict";this.showUnit(this.currentUnit-1);};n.prototype.getTagNameID=function(o){"use strict";var p=o.id.indexOf(':');return o.id.slice(p+1);};n.prototype.showUnit=function(o){"use strict";this.units.forEach(h.hide);this.currentUnit=(o+this.units.length)%this.units.length;var p=this.units[this.currentUnit];h.show(p);this.hiliteCurrentPendingTag();h.conditionClass(i.find(this._root,'a.prevPager'),'enabled',this.currentUnit>0);h.conditionClass(i.find(this._root,'a.nextPager'),'enabled',this.currentUnit<this.units.length-1);};n.prototype.hiliteCurrentPendingTag=function(){"use strict";var o=this.units[this.currentUnit],p=this.getTagNameID(o);g.inform('PhotoTagApproval.HILITE_TAG',{tag:p,version:this.viewer.getVersionConst()});};e.exports=n;},null);
__d("legacy:photo-tag-approval",["PhotoTagApproval"],function(a,b,c,d){b.__markCompiled&&b.__markCompiled();a.PhotoTagApproval=b('PhotoTagApproval');},3);
__d("XFamilyBulkTagAddAsyncController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/family\/bulk_tag_save\/",{subject:{type:"Int"},save_tags:{type:"String"}});},null);
__d("PhotoTagStore",["AsyncRequest","XFamilyBulkTagAddAsyncController","copyProperties","isEmpty"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(){"use strict";this._tagList={};this._textTagList={};this._originalTagList={};this._dirtyPhotosByUid={};k.instance=this;}k.prototype.getPhotoTags=function(l){"use strict";return this._tagList[l]||{};};k.prototype.photoHasTags=function(l){"use strict";return !j(this.getPhotoTags(l));};k.prototype.clear=function(){"use strict";this._tagList={};this._textTagList={};this._originalTagList={};this._dirtyPhotosByUid={};};k.prototype.addTag=function(l,m,n,o){"use strict";l[m]=l[m]||{};var p=l[m][n]||[];p.push(o);l[m][n]=p;};k.prototype.revert=function(l){"use strict";var m=this._tagList,n=this._originalTagList;for(var o in m)if(j(n[o][l])){m[o][l]=[];}else m[o][l]=n[o][l];this._dirtyPhotosByUid={};};k.prototype.hasNewTags=function(){"use strict";return !j(this._tagList)||!j(this._textTagList);};k.prototype.userHasDirtyTags=function(l){"use strict";return !j(this._dirtyPhotosByUid[l]);};k.prototype.userDirtyTagsCount=function(l){"use strict";return Object.keys(this._dirtyPhotosByUid[l]).length;};k.prototype.handleTagFetch=function(l){"use strict";for(var m in l)this.loadTagInfo(m,l[m]);};k.prototype.saveAlbumTagsForUser=function(l,m,n){"use strict";var o={},p=[],q=this._dirtyPhotosByUid[l]||{};for(var r in q){var s=this._tagList[r][l];if(j(s)){p[p.length]=r;continue;}s.forEach(function(v){o[r]={x:v.x,y:v.y};});}var t={subject:l,action:'save',save_tags:o},u='/ajax/photos/album/tags.php';if(n){t={subject:l,save_tags:JSON.stringify(o)};u=h.getURIBuilder().getURI();}new g().setURI(u).setData(t).setHandler(function(v){m(v.payload);}).setAllowCrossPageTransition(true).send();delete this._dirtyPhotosByUid[l];};k.prototype.getTagsFromList=function(l){"use strict";var m=[];for(var n in l)if(l.hasOwnProperty(n))for(var o in l[n])if(l[n].hasOwnProperty(o))l[n][o].forEach(function(p){return m.push(p);});return m;};k.prototype.getAllTags=function(){"use strict";var l=this.getTagsFromList(this._tagList),m=this.getTagsFromList(this._textTagList);return l.concat(m);};k.prototype.removeTag=function(l,m){"use strict";var n=this._tagList[l],o=this._originalTagList[l]||{};if(o[m]){this._dirtyPhotosByUid[m]=this._dirtyPhotosByUid[m]||{};this._dirtyPhotosByUid[m][l]=true;}else delete this._dirtyPhotosByUid[m][l];for(var p in n)if(p==m){var q=this._tagList[l][p];delete this._tagList[l][p];if(j(this._tagList[l]))delete this._tagList[l];return q;}};k.prototype.removeTextTag=function(l,m){"use strict";var n=this._textTagList[l];if(!j(n[m])){var o=this._textTagList[l][m];this._textTagList[l][m]=[];if(j(this._textTagList[l]))delete this._textTagList[l];return o;}return [];};k.prototype.removeAllNewTagsOfUser=function(l){"use strict";var m=[];if(!this.userHasDirtyTags(l))return m;var n=this._dirtyPhotosByUid[l];for(var o in n)m=m.concat(this.removeTag(o,l));return m;};k.prototype.removeAllTagsFromPhoto=function(l){"use strict";var m=[];if(!j(this._tagList[l]))for(var n in this._tagList[l]){if(!this._tagList[l].hasOwnProperty(n))continue;m=m.concat(this.removeTag(l,n));}if(!j(this._textTagList[l]))for(var o in this._textTagList[l]){if(!this._textTagList[l].hasOwnProperty(o))continue;m=m.concat(this.removeTextTag(l,o));}return m;};k.prototype.storeTag=function(l,m,n,o,p){"use strict";this.storeTagWithOptions(l,m,n,o,{can_remove:p});};k.prototype.storeTagWithOptions=function(l,m,n,o,p){"use strict";this._dirtyPhotosByUid[m]=this._dirtyPhotosByUid[m]||{};this._dirtyPhotosByUid[m][l]=true;var q={x:n,y:o};i(q,p);if(!m){this.addTag(this._textTagList,l,q.name,q);}else this.addTag(this._tagList,l,m,q);};k.prototype.loadTagInfo=function(l,m){"use strict";this._tagList[l]={};this._originalTagList[l]={};for(var n=0;n<m.length;n++){var o=m[n];this.addTag(this._tagList,l,o.subject,o);this.addTag(this._originalTagList,l,o.subject,o);}};k.getInstance=function(){"use strict";if(k.instance===null)new k();return k.instance;};k.instance=null;e.exports=k;},null);
__d("PhotosTaggingWaterfall",["AsyncSignal"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(i){h._queueName=i||h._queueName;}Object.assign(h,{BEGIN:"begin",TAG_FACE:"tag_face",HOVER_TAG_FACE:"hover_tag_face",SHOW_SUGGEST:"show_suggest",ADD_NAME:"add_name",TAG_CONFIRMED:"tag_confirmed",FINISH:"finish",TYPE_NAME:'type_name',SELECT_NAME:'select_name',_queueName:null,sendSignal:function(i,j){new g('/ajax/photos/tag_waterfall.php',{data:JSON.stringify(i)}).setHandler(j).send();}});e.exports=h;},null);
__d("PhotoTagger",["Arbiter","AsyncRequest","CSS","DOM","DOMQuery","Event","FaceboxSourceConstants","Hovercard","Keys","Parent","PhotosConst","PhotosTaggingWaterfall","PhotosUtils","PhotoTagStore","Style","URI","Vector","AsyncResponse","csx","getElementPosition","removeFromArray"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){b.__markCompiled&&b.__markCompiled();function ba(da,ea){return ((da%ea)+ea)%ea;}function ca(da){"use strict";this.viewer=da;this.version=da.getVersionConst();this.datasources={};this.photoData={};this.tagRects={};this.ajaxURIs={tagsInit:'/ajax/photos/photo/tags/tags_init.php',tagsAlbum:'/ajax/photos/photo/tags/tags_album.php',fetchDatasource:'/ajax/photos/photo/tags/fetch_datasource.php',tagAction:'/ajax/photo_tagging_ajax.php',tagWithAction:'/ajax/with_tagging_ajax.php'};this.recognizedUsers=[];this.addedSuggestions=[];this.featuredSuggestions=[];this.albumSuggestions=[];this.friendSuggestions=[];this.suggestionAlbum=-1;ca.instances[this.version]=this;}ca.prototype.initSnowlift=function(da,ea,fa){"use strict";this._init(da,ea,fa,this.viewer.container);};ca.prototype.initPermalink=function(da,ea,fa){"use strict";this._init(da,ea,fa,this.viewer.actionList);};ca.prototype._init=function(da,ea,fa,ga){"use strict";this.root=this.viewer.getRoot();this.tagger=da;this.tokenizer=ea;this._qn=null;this.typeahead=ea.getTypeahead();this.userId=fa;this.makeProfilePicMenuContainer=ga;this.faceboxes=[];this.tags=[];this.currentFacebox=null;this.revokedFaceboxes=[];this.requestFaceboxNextTag=false;this.clickState=j.find(this.root,'div.stageActions');this.newTagBox=j.find(this.clickState,'div.newTagBox');this.addTagLink=j.find(this.root,this.elemNames[this.version].addTagLink);this.overlayActions=j.find(this.root,this.elemNames[this.version].overlayActions);this.setupHandlers();this.hideNewTagTimer=null;this.needAlbumSuggestionsFetch=true;this.fetchTaggingSuggestions({owner:this.photoData.owner});this.setDataSource(this.typeahead.getData());this.updateFaceboxes();this.tagAccumulating=false;return this;};ca.prototype.setTagAccumulator=function(da){"use strict";this.tagAccumulating=da;};ca.prototype.fetchTaggingSuggestions=function(da){"use strict";var ea=new v(this.ajaxURIs.tagsInit).setSubdomain('www');new h().setAllowCrossPageTransition(true).setAllowCrossOrigin(true).setURI(ea).setData(da).setOption('retries',1).setHandler(function(ga){var ha=ga.getPayload();this.featuredSuggestions=ha.featuredTaggees;this.friendSuggestions=ha.friendTaggees;this.updateTypeaheadSuggestions();}.bind(this)).send();var fa=this.typeahead.subscribe('bootstrap',function(ga,ha){if(ha&&!ha.bootstrapping){if(this.taggingMode)this.updateWithSuggestions();this.typeahead.unsubscribe(fa);this.typeahead.subscribe('focus',function(){if(this.taggingMode)this.updateWithSuggestions();}.bind(this));this.typeahead.subscribe('click',function(){if(!this.taggingMode)this.updateWithSuggestions();}.bind(this));this.tokenizer.subscribe('removeToken',this.updateWithSuggestions.bind(this));this.tokenizer.subscribe('addToken',this.addSuggestion.bind(this));this.typeahead.subscribe('respond',function(ia,ja){if(this.taggingMode&&ja&&!ja.results.length)this.updateWithSuggestions();}.bind(this));}}.bind(this));};ca.prototype.fetchAlbumTaggingSuggestions=function(){"use strict";new h().setURI(this.ajaxURIs.tagsAlbum).setData({cachedAlbum:this.suggestionAlbum,photo:this.photoData.fbid}).setOption('retries',1).setAllowCrossPageTransition(true).setHandler(function(da){this.needAlbumSuggestionsFetch=false;var ea=da.getPayload();if(ea.length===0)return;this.suggestionAlbum=ea.album;this.albumSuggestions=ea.taggees;this.updateTypeaheadSuggestions();}.bind(this)).send();};ca.prototype.resetAlbumTaggingSuggestions=function(){"use strict";this.needAlbumSuggestionsFetch=true;this.updateTypeaheadSuggestions();};ca.prototype.updateTypeaheadSuggestions=function(){"use strict";this.typeahead.getView().setSuggestions(this.addedSuggestions.concat(this.recognizedUsers,this.featuredSuggestions,this.needAlbumSuggestionsFetch?[]:this.albumSuggestions,this.friendSuggestions));};ca.prototype.saveClickPosition=function(da,ea){"use strict";var fa=w.getElementPosition(da),ga=w.getElementDimensions(da);this.clickPercentToPhoto=new w((ea.x-fa.x)/ga.x,(ea.y-fa.y)/ga.y);};ca.prototype.getCalculatedClickPosition=function(da){"use strict";var ea=w.getElementPosition(da),fa=w.getElementDimensions(da);if(fa.x===0||fa.y===0)return null;return new w(this.clickPercentToPhoto.x*fa.x+ea.x,this.clickPercentToPhoto.y*fa.y+ea.y,'document');};ca.prototype.repositionTagger=function(){"use strict";if(this.clickPercentToPhoto){var da=this.viewer.getImage(),ea=this.getCalculatedClickPosition(da);if(!ea)return;this.addTagFromClickPos(ea);}};ca.prototype.setupHandlers=function(){"use strict";this.handlers=[l.listen(this.clickState,'click',this.addTag.bind(this)),l.listen(this.addTagLink,'click',this.checkActions.bind(this)),l.listen(this.overlayActions,'click',this.checkActions.bind(this))];l.listen(document.documentElement,'keydown',function(event){if(!this.taggingMode)return;var da=l.getKeyCode(event);if(da===o.ESC){this.deactivateTagging();}else if(da===o.TAB)this.addNextTagFromFacebox(event.shiftKey?-1:1);}.bind(this));this.subscriptions=[g.subscribe(this.viewer.getEventString('PAGE'),this.restartTagging.bind(this)),g.subscribe(this.viewer.getEventString('DATA_CHANGE'),this.setPhotoData.bind(this)),g.subscribe(this.viewer.getEventString('EXTRA_DATA_CHANGE'),this.setExtraData.bind(this)),g.subscribe(this.viewer.getEventString('CLOSE'),this.deactivateTagging.bind(this))];this.tokenizer.subscribe('addToken',this.saveTag.bind(this));this.tokenizer.subscribe('removeToken',this.removeTag.bind(this));this.tokenizer.subscribe('markTagAsSpam',this.markTagAsSpam.bind(this));};ca.prototype.updateWithSuggestions=function(da,ea){"use strict";var fa=this.typeahead.getData().buildUids(' ',this.typeahead.getView().getSuggestions(),this.typeahead.getCore().getExclusions());if(!fa.length)return;var ga=this.typeahead.getData().respond('',fa);for(var ha=0;ha<ga.length;ha++)ga[ha].index=-1000+ha;};ca.prototype.addSuggestion=function(da,ea){"use strict";var fa=ea.info&&ea.info.uid;if(fa){this.addedSuggestions.unshift(fa);this.updateTypeaheadSuggestions();}};ca.prototype.setQueueName=function(da){"use strict";this._qn=da;return this;};ca.prototype._sendWaterfallLogSignal=function(da){"use strict";r.sendSignal({qn:this._qn,source:this.viewer.getSourceString(),step:da,pid:this.photoData.pid});};ca.prototype._sendFaceboxSuggestionLogSignal=function(da,ea){"use strict";r.sendSignal({step:r.SHOW_SUGGEST,photo_owner:this.photoData.owner,tagee:da,is_first:true,source:ea});};ca.prototype._bumpQueueName=function(){"use strict";if(this._qn)this._qn+=1;};ca.prototype.activateTagging=function(){"use strict";g.inform('PhotoTagger.ACTIVATE_TAGGING');if(this.getDataSource()){this.dataSourceFetched(this.getDataSource());}else new h(this.ajaxURIs.fetchDatasource).setData({fbid:this.photoData.fbid,version:this.version}).send();if(this.needAlbumSuggestionsFetch)this.fetchAlbumTaggingSuggestions();};ca.prototype.restartTagging=function(){"use strict";this.hideNewTag();this.hideTagger();this.revokedFaceboxes=[];this.setCurrentFacebox(null);if(this.taggingMode){this.requestFaceboxNextTag=true;this.activateTagging();}};ca.prototype.getDataSource=function(){"use strict";return this.datasources[this.getDataSourceKey()];};ca.prototype.getDataSourceKey=function(){"use strict";if(this.photoData.ownertype=='user'&&!this.photoData.obj_id)return 'friends';return this.photoData.obj_id||this.photoData.owner;};ca.prototype.setDataSource=function(da){"use strict";if(this.typeahead.getData()!=da)this.typeahead.swapData(da);this.datasources[this.getDataSourceKey()]=da;};ca.prototype.dataSourceFetched=function(da){"use strict";this.taggingMode=true;i.addClass(this.root,'taggingMode');this._hidePivots();g.inform('PhotoTagger.ACTIVATED_TAGGING');this._bumpQueueName();this._sendWaterfallLogSignal(r.BEGIN);this.setDataSource(da);};ca.prototype.deactivateTagging=function(){"use strict";if(this.taggingMode===true)this._sendWaterfallLogSignal(r.FINISH);this.taggingMode=false;this.hideNewTag();this.hideTagger();this.setCurrentFacebox(null);this._showPivots();i.removeClass(this.root,'taggingMode');g.inform('PhotoTagger.DEACTIVATED_TAGGING');};ca.prototype._hidePivots=function(){"use strict";var da=k.scry(this.root,'.tag');for(var ea=0;ea<da.length;ea++)i.hide(da[ea]);};ca.prototype._showPivots=function(){"use strict";var da=k.scry(this.root,'.tag');for(var ea=0;ea<da.length;ea++)i.show(da[ea]);};ca.prototype.checkActions=function(event){"use strict";var da=event.getTarget();if(p.byClass(da,'fbPhotosPhotoActionsTag'))if(this.taggingMode){this.deactivateTagging();}else{this.activateTagging();this.addNextTagFromFacebox(1);}};ca.prototype.hideTagger=function(){"use strict";i.hide(this.tagger);this.clickPercentToPhoto=null;var da=j.scry(this.tagger,'input.textInput')[0];if(da)da.blur();};ca.prototype.showTagger=function(){"use strict";var da=j.find(this.tagger,'.typeaheadContainer'),ea=j.find(da,'.arrow .nub'),fa=z(da),ga=3;u.set(da,'margin-left',0);u.set(ea,'margin-left',0);i.show(this.tagger);if(fa.x<0){u.set(da,'margin-left',((-2*fa.x)+'px'));u.set(ea,'margin-left',(fa.x-ga)+'px');}setTimeout((function(){j.find(this.tagger,'input.textInput').focus();}).bind(this),0);this.hideNewTag();g.inform('reflow');};ca.prototype.showNewTag=function(da){"use strict";if(!this.newTagBox)return;j.setContent(j.find(this.newTagBox,'div.tagName'),j.create('span',null,da));i.show(this.newTagBox);this.hideNewTagTimer=setTimeout(this.hideNewTag.bind(this),3000);};ca.prototype.hideNewTag=function(){"use strict";if(!this.newTagBox)return;if(this.hideNewTagTimer!==null){clearTimeout(this.hideNewTagTimer);this.hideNewTagTimer=null;}i.hide(this.newTagBox);};ca.prototype.getTaggerPositioningOrigin=function(){"use strict";return w.getElementPosition(this.clickState,'document');};ca.prototype.setClickPosAndFacebox=function(da){"use strict";var ea=this.viewer.getImage();this.saveClickPosition(ea,da);var fa=s.absoluteToNormalizedPosition(ea,da);this.setCurrentFacebox(this.findNearestFacebox(fa));};ca.prototype.addTagFromClickPos=function(da){"use strict";if(this.currentFacebox){this.addTagFromFaceboxDontSave(this.currentFacebox);}else{this.removeSuggestionFromTagger();i.removeClass(j.find(this.tagger,'.faceBox'),'faceBoxHidden');this.addTagFromPosition(da,this.TAG_BOX_SIZE);}};ca.prototype.addTag=function(event){"use strict";var da=event.getTarget(),ea=p.byClass(da,'fbPhotosPhotoButtons');if(!this.taggingMode||(ea&&da!==ea)||p.byClass(da,'fbPhotosPhotoActions')||p.byClass(da,'faceboxSuggestion')||p.byClass(da,'photoTagTypeahead'))return;var fa=w.getEventPosition(event);this.setClickPosAndFacebox(fa);this.addTagFromClickPos(fa);};ca.prototype._findNearest=function(da,ea){"use strict";var fa=Infinity,ga=null;da.forEach(function(ha){if(ha.rect.contains(ea)){var ia=ea.distanceTo(ha.rect.getCenter());if(ia<fa){fa=ia;ga=ha;}}});return ga;};ca.prototype.findNearestFacebox=function(da){"use strict";return this._findNearest(this.faceboxes,da);};ca.prototype.findNearestTag=function(da){"use strict";return this._findNearest(this.tags,da);};ca.prototype.addNextTagFromFacebox=function(da){"use strict";if(this.faceboxes.length===0)return;if(!this.currentFacebox){this.setCurrentFacebox(this.faceboxes[0]);}else{var ea=this.faceboxes.indexOf(this.currentFacebox),fa=ba(ea+da,this.faceboxes.length);if(fa===ea)return;this.setCurrentFacebox(this.faceboxes[fa]);}this.addTagFromFacebox(this.currentFacebox);};ca.prototype.addTagFromFaceboxDontSave=function(da){"use strict";i.addClass(da.node,'active');i.addClass(j.find(this.tagger,'.faceBox'),'faceBoxHidden');var ea=da.rect.getCenter(),fa=this.viewer.getImage(),ga=s.normalizedToAbsolutePosition(fa,ea),ha=(da.rect.w()/100)*w.getElementDimensions(fa).x;if(da.rect.w()>this.HUGE_FACE_THRESH&&da.rect.h()>this.HUGE_FACE_THRESH)ha*=this.HUGE_FACE_SHRINK_FACTOR;var ia=this.getFaceboxSuggestionFromFaceboxElem(da.node);if(ia){var ja=(this.version===q.VIEWER_PERMALINK)?m.PERMALINK_DISMISS:m.SNOWLIFT_DISMISS;this.addSuggestionToTagger(da,ia);this._sendFaceboxSuggestionLogSignal(ia.getAttribute('data-id'),ja);}else this.removeSuggestionFromTagger();this.addTagFromPosition(ga,ha);return ga;};ca.prototype.getFaceboxSuggestionFromFaceboxElem=function(da){"use strict";return j.scry(da,"._570u")[0];};ca.prototype.addSuggestionToTagger=function(da,ea){"use strict";this.removeSuggestionFromTagger();i.addClass(this.tagger,'suggestionActive');var fa=j.find(this.tagger,'.typeaheadContainer'),ga=ea.cloneNode(true);this.stripReactID(ga);j.appendContent(fa,ga);this.setupFaceboxSuggestionHandlers(da,ga);};ca.prototype.stripReactID=function(da){"use strict";da.removeAttribute('data-reactid');for(var ea=0;ea<da.children.length;ea++)this.stripReactID(da.children[ea]);};ca.prototype.removeSuggestionFromTagger=function(){"use strict";i.removeClass(this.tagger,'suggestionActive');var da=j.scry(this.tagger,'.faceboxSuggestion');da&&da.forEach(function(ea){j.remove(ea);});};ca.prototype.dismissFaceboxSuggestion=function(da,ea,fa,ga){"use strict";new h().setURI('/ajax/dismiss_tag_suggest.php').setMethod('POST').setData({facebox_logs:[{facebox:da,log_data:{photo_owner:fa,tagee:ea,is_first:true}}],closing_source:ga,closing_action:'no'}).setAllowCrossPageTransition(true).send();};ca.prototype.addTagFromFacebox=function(da){"use strict";var ea=this.addTagFromFaceboxDontSave(da),fa=this.viewer.getImage();this.saveClickPosition(fa,ea);};ca.prototype.addTagFromPosition=function(da,ea){"use strict";var fa=this.viewer.getImage(),ga=this.calcTaggerPosition(fa,da,ea);this.calcClickPoint(fa,da);if(!ga){this.hideTagger();return;}ga.setElementPosition(this.tagger);if(this.newTagBox){ga.setElementPosition(this.newTagBox);new w(ea,ea).setElementDimensions(this.newTagBox);}var ha=w.getElementPosition(fa),ia=w.getElementDimensions(fa),ja=this.typeahead.getView();if(da.y>ha.y+ia.y*3/4){i.addClass(this.tagger,'fbPhotoTaggerFlipped');ja.addTypeaheadFlip('fbPhotoTaggerFlipped');if(da.x>ha.x+ia.x*1/2){this.flipRules('fbPhotoTaggerRight','fbPhotoTaggerLeft',ja);}else this.flipRules('fbPhotoTaggerLeft','fbPhotoTaggerRight',ja);}else{i.removeClass(this.tagger,'fbPhotoTaggerFlipped');i.removeClass(this.tagger,'fbPhotoTaggerLeft');i.removeClass(this.tagger,'fbPhotoTaggerRight');ja.removeTypeaheadFlip('fbPhotoTaggerFlipped');ja.removeTypeaheadFlip('fbPhotoTaggerLeft');ja.removeTypeaheadFlip('fbPhotoTaggerRight');}this.showTagger();if(this.taggingMode){this._sendWaterfallLogSignal(r.TAG_FACE);}else this._sendWaterfallLogSignal(r.HOVER_TAG_FACE);};ca.prototype.flipRules=function(da,ea,fa){"use strict";i.addClass(this.tagger,da);i.removeClass(this.tagger,ea);fa.addTypeaheadFlip(da);fa.removeTypeaheadFlip(ea);};ca.prototype.calcTaggerPosition=function(da,ea,fa,ga){"use strict";ga=ga||fa;var ha=w.getElementPosition(da),ia=w.getElementDimensions(da),ja=new w(fa/2,ga/2),ka=ea.sub(ha);for(var la in {x:1,y:1}){if(ea[la]<ha[la]||ea[la]>ha[la]+ia[la])return null;var ma=la==='x'?fa:ga;if(ka[la]<(ma/2)){ja[la]=ka[la];}else if(ia[la]<ka[la]+(ma/2))ja[la]=ma-(ia[la]-ka[la]);}var na=3,oa=j.find(this.tagger,'.faceBox');u.set(oa,'width',(fa-na*2)+'px');u.set(oa,'height',(ga-na*2)+'px');var pa=ea.sub(this.getTaggerPositioningOrigin());return pa.sub(ja.x,ja.y);};ca.prototype.calcClickPoint=function(da,ea){"use strict";var fa=w.getElementDimensions(da),ga=w.getElementPosition(da),ha=ea.sub(ga);this.clickPoint={x:ha.x/fa.x,y:ha.y/fa.y};};ca.prototype.getTaggingDataForSave=function(da,ea){"use strict";var fa=this.getTaggingData('add',da.isFreeform()?'':da.getValue(),da.getText(),ea);fa.x=this.clickPoint.x*100;fa.y=this.clickPoint.y*100;fa.from_facebox=!!this.currentFacebox;fa.tagging_mode=!!this.taggingMode;return fa;};ca.prototype.saveTag=function(da,ea,fa){"use strict";var ga=this.getTaggingDataForSave(ea,fa);if(this.tagAccumulating){t.getInstance().storeTagWithOptions(this.photoData.fbid,ga.subject,ga.x,ga.y,ga);}else new h().setURI(this.ajaxURIs.tagAction).setMethod('POST').setData(ga).setAllowCrossPageTransition(true).setHandler(this.tagsChangeHandler.bind(this)).setErrorHandler(this.checkError.bind(this,ea)).send();var ha=(this.userId===ga.subject);if(ha){var ia=j.scry(this.makeProfilePicMenuContainer,'[data-picid="'+this.viewer.getCurrentPhotoInfo().fbid+'"]');if(ia.length===1){var ja=ia[0];i.removeClass(ja,'hide');}}this.showNewTag(ea.getText());this.hideTagger();var ka=this.currentFacebox;if(ka){if(this.taggingMode)this.addNextTagFromFacebox(1);this.removeFacebox(ka);}g.inform('PhotoTagger.ADDING_TAG',{subject:ga.subject,text:ea.getText()});g.inform('PhotoTagger.SAVE_TAG',{photo_fbid:this.photoData.fbid,self_tag:ha});};ca.prototype.getTaggingData=function(da,ea,fa,ga){"use strict";return {cs_ver:this.version,pid:this.photoData.pid,fbid:this.photoData.fbid,id:this.photoData.owner,subject:ea,name:fa,action:da,source:ga?ga:this.viewer.getSourceString(),qn:this._qn,position:this.getPosition(),slsource:this.viewer.getViewerSource(),slset:this.viewer.getViewerSet()};};ca.prototype.getPosition=function(){"use strict";return this.viewer.getPosition();};ca.prototype.tagsChangeHandler=function(da){"use strict";};ca.prototype.checkError=function(da,ea){"use strict";if(ea.getPayload()&&ea.getPayload().clear_tag){da.already_untagged=true;this.tokenizer.removeToken(da);}x.defaultErrorHandler(ea);};ca.prototype.removeTag=function(da,ea,fa){"use strict";if(ea.already_untagged)return;var ga='remove';if(j.scry(ea.element,'a.pending')[0])ga='retract';if(ea.blockUser)ga='remove_block';if(this.tagAccumulating){if(ea.isFreeform()){t.getInstance().removeTextTag(this.photoData.fbid,ea.getInfo().text);}else t.getInstance().removeTag(this.photoData.fbid,ea.getInfo().uid);}else new h().setURI(this.ajaxURIs.tagAction).setMethod('POST').setData(this.getTaggingData(ga,ea.isFreeform()?'':ea.getInfo().uid,ea.getInfo().text)).setHandler(function(ja){this.tagsChangeHandler(ja);fa&&fa();}.bind(this)).setAllowCrossPageTransition(true).send();if(this.userId===parseInt(ea.getValue(),10)&&this.userId!==this.viewer.getCurrentPhotoInfo().owner){var ha=j.scry(this.makeProfilePicMenuContainer,'[data-picid="'+this.viewer.getCurrentPhotoInfo().fbid+'"]');if(ha.length===1){var ia=ha[0];i.addClass(ia,'hide');}g.inform('PhotoTagger.REMOVED_MAKE_PROFILE_PIC_OPTION');}};ca.prototype.removeTagByID=function(da,ea,fa){"use strict";var ga=this.tokenizer.tokens;for(var ha=0;ha<ga.length;ha++)if(ga[ha].info.uid==ea)return this.removeTag(null,ga[ha],fa);};ca.prototype.removeTagByIDFromHovercardLink=function(da,ea,fa){"use strict";this.removeTagByID(da,ea,function(){if(n.contains(fa))n.hide(true);});};ca.prototype.removeWithTag=function(da,ea){"use strict";new h().setURI(this.ajaxURIs.tagWithAction).setMethod('POST').setData({action:'remove_with',taggee:ea,tag:da,version:this.version,fbid:this.photoData.fbid}).setHandler(function(fa){this.tagsChangeHandler(fa);if(window.Hovercard)window.Hovercard.hide(true);}.bind(this)).setAllowCrossPageTransition(true).send();};ca.prototype.setPhotoData=function(da,ea){"use strict";this.clickPercentToPhoto=null;this.photoData=ea;return this;};ca.prototype.setExtraData=function(da,ea){"use strict";this.tagRects=ea.tagRects;this.updateFaceboxes();this._setInitialFaceboxFromID(ea);if(ea.openTag)setTimeout(function(){this.activateTagging();this._setInitialFaceboxFromID(ea);if(this.faceboxes.length===1){this.addTagFromFacebox(this.currentFacebox);}else this.addNextTagFromFacebox(1);}.bind(this),0);return this;};ca.prototype._setInitialFaceboxFromID=function(da){"use strict";if(da.initialFaceboxID!==null&&this.faceboxes.length!==0){var ea=this.getFacebox(da.initialFaceboxID);if(ea!==null){var fa=this.faceboxes.indexOf(ea);fa=ba(fa-1,this.faceboxes.length);this.setCurrentFacebox(this.faceboxes[fa]);}}};ca.prototype.markTagAsSpam=function(da,ea){"use strict";new h().setURI(this.ajaxURIs.tagAction).setMethod('POST').setData(this.getTaggingData('mark_as_spam',ea,null)).send();};ca.prototype.removeFacebox=function(da){"use strict";if(da===null)return;this.revokedFaceboxes.push(da.rect.getCenter());aa(this.faceboxes,da);j.remove(da.node);if(da===this.currentFacebox)this.setCurrentFacebox(null);};ca.prototype.setCurrentFacebox=function(da){"use strict";if(this.currentFacebox)i.removeClass(this.currentFacebox.node,'active');this.currentFacebox=da;if(da){this.recognizedUsers=JSON.parse(da.node.getAttribute('data-recognizeduids'));this.updateTypeaheadSuggestions();}};ca.prototype.updateRevokedFaceboxes=function(){"use strict";this.revokedFaceboxes=this.revokedFaceboxes.filter(function(da){for(var ea=0;ea<this.faceboxes.length;++ea){var fa=this.faceboxes[ea],ga=da.distanceTo(fa.rect.getCenter());if(ga<this.EPSILON)return true;}return false;}.bind(this));this.revokedFaceboxes.forEach(function(da){var ea=this.findNearestFacebox(da);aa(this.faceboxes,ea);j.remove(ea.node);}.bind(this));};ca.prototype.updateFaceboxes=function(){"use strict";this.faceboxes=[];this.tags=[];for(var da in this.tagRects){var ea;if(s.isFacebox(da)){ea=this.faceboxes;}else if(s.isTag(da))ea=this.tags;if(ea){var fa='container';if(this.version===q.VIEWER_PERMALINK)fa='root';var ga=j.scry(this.viewer[fa],'#'+da);if(ga.length>0)ea.push({node:ga[0],id:da,rect:this.tagRects[da]});}}this.updateRevokedFaceboxes();this.faceboxes.sort(function(ia,ja){return ia.rect.getCenter().x-ja.rect.getCenter().x;});if(this.currentFacebox){var ha=this.currentFacebox.rect.getCenter();this.setCurrentFacebox(this.findNearestFacebox(ha));i.addClass(this.currentFacebox.node,'active');}if(this.requestFaceboxNextTag){this.addNextTagFromFacebox(1);this.requestFaceboxNextTag=false;}};ca.prototype.getFacebox=function(da){"use strict";for(var ea=0;ea<this.faceboxes.length;++ea)if(this.faceboxes[ea].id===da)return this.faceboxes[ea];return null;};ca.prototype.setupFaceboxSuggestionHandlers=function(da,ea){"use strict";var fa=j.find(ea,"a._570w"),ga=j.find(ea,"a._570x");this.handlers.push(l.listen(fa,'click',function(ha){var ia=this._getCurrentFaceboxID(),ja=(this.version===q.VIEWER_PERMALINK)?m.PERMALINK_DISMISS:m.SNOWLIFT_DISMISS;this.dismissFaceboxSuggestion(da.id.replace('face:',''),ea.getAttribute('data-id'),this.photoData.owner,ja);this.removeSuggestionFromTagger();this.hideTagger();j.remove(this.getFaceboxSuggestionFromFaceboxElem(da.node));g.inform('PhotoTagger.TAG_SUGGESTION_REJECTED/'+ia);}.bind(this)),l.listen(ga,'click',function(ha){var ia=this._getCurrentFaceboxID(),ja={uid:ea.getAttribute('data-id'),text:ea.getAttribute('data-text')},ka=this.tokenizer.createToken(ja),la=(this.version===q.VIEWER_PERMALINK)?m.PERMALINK_SUGGEST:m.SNOWLIFT_SUGGEST;this.saveTag(null,ka,la);g.inform('PhotoTagger.TAG_SUGGESTION_CONFIRMED/'+ia);}.bind(this)));};ca.prototype._getCurrentFaceboxID=function(){"use strict";return this.currentFacebox&&this.currentFacebox.id.substring(5);};ca.getInstance=function(da){"use strict";return ca.instances[da];};ca.resetAlbumTaggingSuggestions=function(da){"use strict";var ea=ca.getInstance(da);ea&&ea.resetAlbumTaggingSuggestions();};Object.assign(ca,{instances:{}});Object.assign(ca.prototype,{TAG_BOX_SIZE:100,EPSILON:.0025,HUGE_FACE_THRESH:90,HUGE_FACE_SHRINK_FACTOR:.6,elemNames:{6:{addTagLink:'div.fbPhotosPhotoOwnerButtons',overlayActions:'div.snowliftOverlayBar'}}});e.exports=ca;},null);
__d("PhotoPermalink",["Arbiter","Assert","AsyncRequest","Bootloader","CSS","DOM","Event","GraphicPhotoWarning","GraphicPhotoWarningMixin","KeyEventController","Keys","PageTransitions","Parent","PhotoPermalinkURI","PhotosConst","PhotoSessionLog","PhotoStreamCache","PhotoTagSearchPivotLogger","PhotosUtils","PhotoTagger","PhotoViewer","Scroll","Style","Vector","$","classWithMixins","copyProperties","createArrayFromMixed","csx","emptyFunction","ge","goURI","mixin","GraphicPhotoWarningConfig"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma){b.__markCompiled&&b.__markCompiled();var na=b('GraphicPhotoWarningConfig').Events,oa=fa(aa,ma(o));for(var pa in oa)if(oa.hasOwnProperty(pa))ra[pa]=oa[pa];var qa=oa===null?null:oa.prototype;ra.prototype=Object.create(qa);ra.prototype.constructor=ra;ra.__superConstructor__=oa;function ra(){"use strict";oa.call(this);this._uriStack=[];this.replaceUrl=false;this.payloadInitialized=false;this._seenTags={};}ra.prototype.init=function(sa){"use strict";this.stream=new w();this.stream.init(u.VIEWER_PERMALINK,'PhotoViewerPagelet','pagelet_photo_viewer');this.reset();this.root=ea('fbPhotoPageContainer');this.header=ea('fbPhotoPageHeader');this.stageWrapper=l.find(this.root,'.stageContainer');this.videoStage=l.find(this.stageWrapper,'div.videoStage');this.buttonActions=l.find(this.root,'div.stageButtons');this.viewLargerLink=l.scry(this.root,'a.fbPhotoViewLarger').pop();this.feedback=ka('fbPhotoPageFeedback');this.image=ka('fbPhotoImage');this.errorBox=ka('fbPhotoPageError');this.actionList=ka('fbPhotoPageActions');this.stageActions=l.find(this.root,'div.stageActions');this.photoContentContainer=ea('fbxPhotoContentContainer');this.photoImageStage=l.find(this.root,'.fbPhotoImageStage');this.existingPhotoWarning=l.scry(this.root,"._5xrx").pop();this.initGraphicWarningDOM(this.existingPhotoWarning||sa.graphic_warning_markup);this._canSeeGraphicWarning=!!sa.can_see_graphic_warning;this.showingTypeaheadSuggestions=false;this.loadingStates={image:false,html:false};this.unhiliteTimer=null;this.source=null;if(this.image)this.imageLoadListener=m.listen(this.image,'load',this.adjustForNewData.bind(this));this.pageHandlers=[m.listen(this.root,'mouseout',this.mouseOutListener.bind(this)),m.listen(this.root,'mousemove',this.mouseMoveListener.bind(this)),m.listen(this.stageWrapper,'click',this.stageClickListener.bind(this)),m.listen(this.buttonActions,'click',this.buttonListener.bind(this)),m.listen(this.actionList,'click',this.rotateListener.bind(this)),m.listen(this.feedback,'click',function(event){var ta=event.getTarget();if(s.byClass(ta,'like_link')||(s.byClass(ta,'UFILikeLink')&&s.byClass(ta,'UIActionLinks')))k.toggleClass(l.find(this.buttonActions,'div.likeCommentGroup'),'viewerLikesThis');}.bind(this))];r.registerHandler(this.transitionHandler.bind(this));p.registerKey('LEFT',this.goNav.bind(this));p.registerKey('RIGHT',this.goNav.bind(this));v.initLogging(v.PERMALINK);this._showHover=sa.pivot_hover;g.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));g.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));this.adjustForNewData();};ra.prototype.getEventPrefix=function(){"use strict";return 'PhotoPermalink';};ra.prototype.getSourceString=function(){"use strict";return 'permalink';};ra.prototype.getViewerSource=function(){"use strict";return this.source;};ra.prototype.getViewerSet=function(){"use strict";return this.stream.getPhotoSet();};ra.prototype.getVersionConst=function(){"use strict";return u.VIEWER_PERMALINK;};ra.prototype.getGraphicWarningContainer=function(){"use strict";return this.photoContentContainer;};ra.prototype.getGraphicWarningHiddenContent=function(){"use strict";return this.photoImageStage;};ra.prototype.saveTagsFromPayload=function(sa){"use strict";this.storeFromData(sa);if('data' in sa&&this.stream.getCursor() in sa.data)this.swapData();};ra.prototype.goNav=function(event){"use strict";var sa=m.getKeyCode(event)||event.getTarget(),ta=event.type==='click'&&s.byClass(sa,'stageWrapper')&&!s.byClass(sa,'tagBoxPending')&&!s.byClass(sa,'tagBoxPendingResponse')&&!s.byClass(sa,'uiButtonGroup');if(ta&&k.hasClass(this.root,'taggingMode'))return false;if(sa==q.LEFT){this.page(-1);}else if(sa==q.RIGHT||ta)this.page(1);return false;};ra.prototype.pagerClick=function(sa){"use strict";if(sa=='prev'){this.page(-1);}else if(sa=='next')this.page(1);return false;};ra.prototype.setLoadingState=function(sa,ta){"use strict";switch(sa){case ra.STATE_IMAGE_DATA:this.loadingStates[sa]=ta;k.conditionClass(this.root,'imageLoading',ta);break;case ra.STATE_HTML:this.loadingStates[sa]=ta;k.conditionClass(this.root,'dataLoading',ta);break;}};ra.prototype.checkState=function(sa){"use strict";if(sa!=ra.STATE_ERROR&&!this.loadingStates[sa])return;switch(sa){case ra.STATE_IMAGE_DATA:var ta=this.stream.getCurrentImageData();if(ta){if(ta.url){this.switchImage(ta.url,true);}else if(ta.video)this.switchVideo(ta.video,true);this.setLoadingState(sa,false);}break;case ra.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(sa,false);}break;default:if(this.stream.errorInCurrent()){if(this.image)k.hide(this.image);k.show(this.errorBox);}break;}};ra.prototype.reHilitePendingTag=function(){"use strict";var sa=ka(this.hilitedTag);if(sa&&k.hasClass(sa,'showPendingTagName'))return;var ta=l.scry(this.root,'div.tagsWrapper div.showPendingTagName')[0];if(ta)this.switchHilitedTags(ta.id);};ra.prototype.setReachedLeftEnd=function(){"use strict";this.stream.setReachedLeftEnd();};ra.prototype.setReachedRightEnd=function(){"use strict";this.stream.setReachedRightEnd();};ra.prototype.isPagingAllowed=function(sa){"use strict";return this.stream.isValidMovement(sa)&&!k.hasClass(this.root,'croppingMode');};ra.prototype.page=function(sa,ta){"use strict";if(!this.isPagingAllowed(sa)||!this.stream.nonCircularPhotoSetCanPage(sa))return;this._seenTags={};this.unhiliteAllTags();var ua=this.getVideoOnStage();if(ua)this.switchVideo(ua,false);this.recacheData();this.stream.moveCursor(sa);if(this.image)k.hide(this.image);if(this.stream.errorInCurrent()){this.setLoadingState(ra.STATE_HTML,true);k.show(this.errorBox);return;}var va=this.stream.getCurrentImageData();if(va){if(va.url){if(sa!==0)if(va.info.isgraphic){if(this._canSeeGraphicWarning){this.showGraphicWarning();n.log(na.GRAPHIC_PHOTO_SHOWN_WITH_WARNING);}else{this.hideGraphicWarning();n.log(na.GRAPHIC_PHOTO_SHOWN_NO_WARNING);}}else this.hideGraphicWarning();this.switchImage(va.url,true);if(this.viewLargerLink)this.viewLargerLink.setAttribute('href',va.info.permalink);}else if(va.video)this.switchVideo(va.video,true);if(!ta){this.replaceUrl=true;la(va.info.permalink);}}else{this.waitForLoadCount++;this.setLoadingState(ra.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(ra.STATE_HTML,true);g.inform('PhotoPermalink.PAGE');};ra.prototype.transitionHandler=function(sa){"use strict";if(!t.isValid(sa))return false;var ta=sa.getQualifiedURI().toString();if(!sa.protocol)ta=ta.replace(/^file:\/\//,"");if(this.replaceUrl){this.replaceUrl=false;this._uriStack.push(ta);r.transitionComplete();return true;}var ua=this._uriStack.length;if(ua>=2&&this._uriStack[ua-2]===ta)this._uriStack.pop();var va=this.stream.getCursorForURI(sa.getUnqualifiedURI().toString());if(va){var wa=this.stream.getRelativeMovement(va);this.page(wa,true);r.transitionComplete();return true;}return false;};ra.prototype.recacheData=function(sa){"use strict";if(!this.loadingStates.html){var ta=this.stream.getCurrentHtml();for(var ua in ta){var va=ka(ua);if(va)ta[ua]=ha(va.childNodes);if(sa!==true&&ua!=='fbPhotoPageHeader')l.empty(ea(ua));}}};ra.prototype.getCurrentPhotoInfo=function(){"use strict";var sa=this.stream.getCurrentImageData();return sa&&sa.info;};ra.prototype.getVideoOnStage=function(){"use strict";var sa=this.stream.getCurrentImageData();return sa&&sa.video;};ra.prototype.switchImage=function(sa,ta){"use strict";k.hide(this.image);k.hide(this.errorBox);var ua=this.stream&&this.stream.getCurrentImageData();if(ua){v.addPhotoView(ua.info);if(this._showHover){var va=this.stream.getCurrentExtraData();if(va)x.logImageImpression('permalink',String(this.stream.getCursor()),Object.keys(va.tagRects));}}var wa=l.create('img',{id:'fbPhotoImage',className:'fbPhotoImage',alt:'',src:sa});l.replace(this.image,wa);this.image=wa;if(this.imageLoadListener)this.imageLoadListener.remove();this.imageLoadListener=m.listen(this.image,'load',this.adjustForNewData.bind(this));if(ta)this.stream.preloadImages();};ra.prototype.switchVideo=function(sa,ta){"use strict";var ua='swf_'+sa;if(ta){k.addClass(this.stageWrapper,'showVideo');this.videoStage.id=sa;if(window[ua]&&!ka(ua))window[ua].write(sa);}else{this.videoStage.id='fbPageVideoStage';window[ua].addVariable('video_autoplay',0);l.empty(this.videoStage);k.removeClass(this.stageWrapper,'showVideo');}};ra.prototype.swapData=function(){"use strict";if(this.dataLoadTimer){this.setLoadingState(ra.STATE_HTML,true);clearTimeout(this.dataLoadTimer);this.dataLoadTimer=setTimeout(this.clearTimer.bind(this,true),100);return;}var sa,ta=this.stream.getCurrentHtml();if(ta){for(var ua in ta){var va=ta[ua];if(Array.isArray(va)&&va.length===1&&va[0]===(void 0))continue;sa=ka(ua);sa&&l.setContent(sa,ta[ua]);}g.inform('PhotoPermalink.DATA_CHANGE',this.stream.getCurrentImageData().info,g.BEHAVIOR_STATE);if(this.stream.getCurrentExtraData()){g.inform('PhotoPermalink.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),g.BEHAVIOR_STATE);var wa=this.stream.getCurrentExtraData();if(wa&&wa.source!==(void 0)){this.source=wa.source;v.setSource(this.source);}}this.setLoadingState(ra.STATE_HTML,false);this.dataLoadTimer=setTimeout(this.clearTimer.bind(this,false),100);}this.adjustForNewData();};ra.prototype.clearTimer=function(sa){"use strict";this.dataLoadTimer=false;sa&&this.swapData();};ra.prototype.adjustForNewData=function(){"use strict";if(!this.image)return;var sa=l.scry(this.stageWrapper,'div.tagsWrapper')[0],ta=da.getElementDimensions(this.image);if(sa){ca.set(sa,'width',ta.x+'px');ca.set(sa,'height',ta.y+'px');}};ra.prototype.fetchInitBucket=function(sa){"use strict";if(!this.stream.isLoaded())return;this.stream.fetch(sa,true);};ra.prototype.addPhotoFbids=function(sa,ta,ua){"use strict";var va=this.stream.getCursor()===null;this.stream.attachToFbidsList(sa,ta,ua);if(ua&&va)this.page(0);};ra.prototype.attachTagger=function(sa){"use strict";l.appendContent(this.stageActions,sa);};ra.prototype.storeFromData=function(sa){"use strict";var ta=this.stream.storeToCache(sa);if('init' in sa){v.setPhotoSet(this.stream.getPhotoSet());v.setLogFbids(true);v.addPhotoView(this.stream.getCurrentImageData().info);if(this._showHover){var ua=this.stream.getCurrentExtraData();if(ua)x.logImageImpression('permalink',String(this.stream.getCursor()),Object.keys(ua.tagRects));}}if('error' in ta){this.checkState(ra.STATE_ERROR);return;}if('image' in ta)this.checkState(ra.STATE_IMAGE_DATA);if('data' in ta)this.checkState(ra.STATE_HTML);if(!this.payloadInitialized&&this.stream.getCurrentExtraData()){this.payloadInitialized=true;g.inform('PhotoPermalink.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),g.BEHAVIOR_STATE);}};ra.prototype.handleServerError=function(sa,ta){"use strict";l.setContent(this.errorBox,sa);this.storeFromData(ta);};ra.prototype.updateTotalCount=function(sa,ta,ua){"use strict";var va=ka('fbPhotoPagePositionAndCount');va&&l.setContent(va,ua);this.stream.setTotalCount(sa);this.stream.setFirstCursorIndex(ta);};ra.prototype.buttonListener=function(event){"use strict";var sa=event.getTarget();if(s.byClass(sa,'likeButton')){var ta=l.scry(this.feedback,'button.like_link')[0];if(!ta)ta=l.scry(this.feedback,'a.UFILikeLink')[0];ta&&ta.click();}else if(s.byClass(sa,'commentButton')){var ua=l.scry(this.feedback,'div.commentBox textarea')[0];if(!ua)ua=l.scry(this.feedback,'li.UFIAddComment textarea')[0];if(ua){ua.focus();ba.setTop(this.root,this.root.scrollHeight);}}};ra.prototype.rotateListener=function(event){"use strict";var sa=event.getTarget();if(s.byClass(sa,'rotateRight')){this.rotate('right');}else if(s.byClass(sa,'rotateLeft'))this.rotate('left');};ra.prototype.stageClickListener=function(event){"use strict";var sa=event.getTarget(),ta=k.hasClass(sa,'faceBox'),ua=(s.byClass(sa,'fbPhotoTagApprovalBox')||s.byClass(sa,'faceboxSuggestion')||s.byClass(sa,'videoStage')||s.byClass(sa,'tag')||s.byClass(sa,'typeaheadWrapper')||s.byClass(sa,'photoTagLink')||s.byClass(sa,'photoTagTypeahead')||s.byClass(sa,'fbPhotoViewLarger')||ta);if(ta){if(!this.showingTypeaheadSuggestions){var va=this.getTagger();va.updateWithSuggestions();setTimeout((function(){l.find(va.tagger,'input.textInput').focus();}).bind(this),0);}this.showingTypeaheadSuggestions=!this.showingTypeaheadSuggestions;}if(ua){return true;}else this.goNav(event);};ra.prototype.rotate=function(sa){"use strict";var ta=this.stream.getCursor();if(this.getVideoOnStage()){var ua=(sa=='left')?270:90;h.isTruthy(this.videoRotateURI,"Video rotate URI not set.");j.loadModules(["VideoRotate"],function(wa){new wa(ta,this.videoRotateURI).motionRotate(ua);}.bind(this));return;}var va=ga({fbid:ta,opaquecursor:this.stream.getOpaqueCursor(ta),cs_ver:u.VIEWER_PERMALINK},this.stream.getPhotoSetQuery());va[sa]=1;this.setLoadingState(ra.STATE_IMAGE_DATA,true);k.hide(this.image);new i('/ajax/photos/photo/rotate/').setMethod('POST').setAllowCrossPageTransition(true).setReadOnly(false).setData(va).setFinallyHandler(this.rotateComplete.bind(this,ta)).send();};ra.prototype.rotateComplete=function(sa,ta){"use strict";if(sa==this.stream.getCursor()){this.setLoadingState(ra.STATE_IMAGE_DATA,false);this.switchImage(this.stream.getCurrentImageData().url);this.swapData();}};ra.prototype.mouseOutListener=function(event){"use strict";var sa=event.getTarget(),ta=event.getRelatedTarget(),ua=s.byClass(sa,'stageActions'),va=s.byClass(sa,'stageWrapper'),wa=s.byClass(ta,'stageActions'),xa=s.byClass(ta,'stageWrapper'),ya=s.byClass(ta,'uiContextualLayer'),za=(!xa&&!ya&&(va&&!wa)||(ua&&!xa));if(za)this.unhiliteAllTags(true);};ra.prototype.mouseMoveListener=function(event){"use strict";var sa=event.getTarget(),ta=(s.byClass(sa,'faceboxSuggestion')||s.byClass(sa,'tagPointer')||s.byClass(sa,'typeaheadWrapper')||s.byClass(sa,'photoTagTypeahead')||s.byClass(sa,'arrow'));if(!s.byClass(sa,'stageActions')&&!s.byClass(sa,'stageWrapper')||ta)return;this.hiliteTagsOnMouseMove(event);};ra.prototype.unhiliteAllTags=function(sa,event){"use strict";l.scry(this.stageWrapper,'div.tagsWrapper div.hover').forEach(function(ua){if(sa&&k.hasClass(ua,'tagBoxPending'))return;k.removeClass(ua,'hover');});if(sa)return;l.scry(this.stageWrapper,'div.tagsWrapper div.otherActive').forEach(function(ua){k.removeClass(ua,'otherActive');});if(this.unhiliteTimer!==null){clearTimeout(this.unhiliteTimer);this.unhiliteTimer=null;}this.hilitedTag=null;this.showingTypeaheadSuggestions=false;if(!k.hasClass(this.root,'taggingMode')){var ta=this.getTagger();if(ta){ta.hideTagger();ta.setCurrentFacebox(null);}}};ra.prototype.getTagger=function(){"use strict";return z.getInstance(u.VIEWER_PERMALINK);};ra.prototype.switchHilitedTags=function(sa,ta){"use strict";this.unhiliteAllTags();this.hiliteAllBoxes();var ua=ka(sa);if(ua){this.hilitedTag=sa;if(!k.hasClass(this.root,'taggingMode')&&y.isFacebox(this.hilitedTag)){var va=this.getTagger();if(va){k.addClass(ua,'hover');var wa=va.getFacebox(sa);va.setCurrentFacebox(wa);if(wa)va.addTagFromFacebox(wa);}}else k.addClass(ua,'hover');if(k.hasClass(ua,'tagBoxPending')&&!k.hasClass(ua,'showPendingTagName')&&ta===true){l.scry(this.stageWrapper,'div.tagsWrapper div.showPendingTagName').forEach(function(xa){k.removeClass(xa,'showPendingTagName');});k.addClass(ua,'showPendingTagName');}}};ra.prototype.hiliteTagsOnMouseMove=function(event){"use strict";if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.unhiliteTimer!==null)return;var sa=event.getTarget();if(s.byClass(sa,'fbPhotoPageTagApproval')||s.byClass(sa,'tagPointer'))return;var ta=s.byClass(sa,'tagBoxPending'),ua=false;if(this.hilitedTag){var va=ka(this.hilitedTag);ua=va&&k.hasClass(va,'tagBoxPending');}var wa=((!this.hilitedTag&&ta)||(!ua&&ta));if(wa){this.switchHilitedTags(ta.id);return;}if(ta&&(ta.id==this.hilitedTag))return;var xa=250,ya=y.absoluteToNormalizedPosition(this.image,da.getEventPosition(event)),za=y.getNearestBox(this.stream.getCurrentExtraData().tagRects,ya);if(!za){if(!ua){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var ab=null;if(ua){var bb={};bb[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];ab=y.getNearestBox(bb,ya);}if(ab!==null&&ua)return;if(this.hilitedTag!=za)if(ua){this.unhiliteTimer=setTimeout(this.unhiliteAllTags.bind(this,false,event),xa);}else{if(this._showHover&&!this._seenTags[za]){this._seenTags[za]=true;x.logPivotImpression('permalnk','pivot_impression',za);}this.switchHilitedTags(za);}};ra.prototype.updateTagBox=function(sa,ta){"use strict";this.unhiliteAllTags();var ua=ka(sa);if(!ua)return;k.addClass(ua,'tagBox');k.addClass(ua,'tagBoxPendingResponse');k.removeClass(ua,'tagBoxPending');k.hide(l.find(ua,'span.tagForm'));if(ta){k.show(l.find(ua,'span.tagApproved'));}else k.show(l.find(ua,'span.tagIgnored'));};ra.prototype.reset=function(){"use strict";while(this.pageHandlers&&this.pageHandlers.length)this.pageHandlers.pop().remove();if(this.imageLoadListener){this.imageLoadListener.remove();this.imageLoadListener=null;}p.getInstance().resetHandlers();};ra.prototype.onHiliteTag=function(sa,ta){"use strict";if(ta.version!=u.VIEWER_PERMALINK)return;var ua=ta.tag;if(ua){this.switchHilitedTags(ua,true);}else this.unhiliteAllTags();};ra.prototype.onUpdateTagBox=function(sa,ta){"use strict";if(ta.version==u.VIEWER_PERMALINK)this.updateTagBox(ta.id,ta.approve);};ra.prototype.setHasLocation=function(sa){"use strict";k.conditionClass(this.root,'hasLocation',sa);};ra.getInstance=function(){"use strict";if(!ra._instance)ra._instance=new ra();return ra._instance;};ra.addPhotoFbids=function(sa,ta,ua){"use strict";ra.getInstance().addPhotoFbids(sa,ta,ua);};ra.setReachedLeftEnd=function(){"use strict";ra.getInstance().setReachedLeftEnd();};ra.setReachedRightEnd=function(){"use strict";ra.getInstance().setReachedRightEnd();};ra.attachTagger=function(sa){"use strict";ra.getInstance().attachTagger(sa);};ra.disableAjaxPipeForVideo=function(){"use strict";var sa=ra.getInstance();if(sa.stream)sa.stream.setUseAjaxPipe(false);};ra.init=function(sa){"use strict";ra.getInstance().init(sa||{});};ra.recacheData=function(sa){"use strict";ra.getInstance().recacheData(sa);};ra.saveTagsFromPayload=function(sa){"use strict";ra.getInstance().saveTagsFromPayload(sa);};ra.saveTagsFromPayloadDelayed=function(sa){"use strict";setTimeout(ra.saveTagsFromPayload.bind(null,sa),2000);};ra.handleServerError=function(sa,ta){"use strict";ra.getInstance().handleServerError(sa,ta);};ra.setHasLocation=function(sa){"use strict";ra.getInstance().setHasLocation(sa);};ra.storeFromData=function(sa){"use strict";ra.getInstance().storeFromData(sa);};ra.swapData=function(){"use strict";ra.getInstance().swapData();};ra.updateTotalCount=function(sa,ta,ua){"use strict";ra.getInstance().updateTotalCount(sa,ta,ua);};ra.setVideoRotateURI=function(sa){"use strict";ra.getInstance().videoRotateURI=sa;};Object.assign(ra,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_DATA:'image',MIN_TAG_DISTANCE:80,_instance:null,touchMarkup:ja});e.exports=ra;},null);
__d("PhotoPermalinkTagger",["Arbiter","Event","PhotoPermalink","PhotoTagger","$"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();for(var l in j)if(j.hasOwnProperty(l))n[l]=j[l];var m=j===null?null:j.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=j;function n(o){"use strict";j.call(this,i.getInstance(),true);this.photoData=o;}n.prototype.setupHandlers=function(){"use strict";var o=k('imagestage'),p=k('fbPhotoPageTagBoxes');this.handlers=[h.listen(this.clickState,'click',this.addTag.bind(this)),h.listen(o,'click',this.addTag.bind(this)),h.listen(p,'click',this.addTag.bind(this)),h.listen(this.addTagLink,'click',this.checkActions.bind(this)),h.listen(this.overlayActions,'click',this.checkActions.bind(this))];this.subscriptions=[g.subscribe('PhotoPermalink.PAGE',this.restartTagging.bind(this)),g.subscribe('PhotoPermalink.DATA_CHANGE',this.setPhotoData.bind(this)),g.subscribe('PhotoPermalink.EXTRA_DATA_CHANGE',this.setExtraData.bind(this))];this.tokenizer.subscribe('addToken',this.saveTag.bind(this));this.tokenizer.subscribe('removeToken',this.removeTag.bind(this));this.tokenizer.subscribe('markTagAsSpam',this.markTagAsSpam.bind(this));};n.prototype.setDataForTokenizer=function(){"use strict";this.tokenizer.setup(null,this.photoData);return this;};Object.assign(n.prototype,{elemNames:{0:{addTagLink:'div.fbPhotosPhotoActions',overlayActions:'div.fbPhotosPhotoButtons'}}});e.exports=n;},null);
__d("legacy:PhotoPermalinkTagger",["PhotoPermalinkTagger"],function(a,b,c,d){b.__markCompiled&&b.__markCompiled();a.PhotoPermalinkTagger=b('PhotoPermalinkTagger');},3);
__d("legacy:fb-photos-permalink-js",["PhotoPermalink"],function(a,b,c,d){b.__markCompiled&&b.__markCompiled();a.PhotoPermalink=b('PhotoPermalink');},3);
__d("PhotoTags",["Arbiter","CSS","DOM","Event","Parent","PhotosConst","cx","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();function o(p,q,r){"use strict";this.tagTargets=p;this.tagBox=q;this.version=r||l.VIEWER_PERMALINK;this.handlers=[];this.tagTargets.forEach(function(s){this.handlers.push(j.listen(s,{mouseover:this.showTag.bind(this),mouseout:this.hideTags.bind(this)}));}.bind(this));this.subscriptions=[];if(this.version==l.VIEWER_SNOWLIFT)this.subscriptions.push(g.subscribe("PhotoSnowlift.PAGE",this.hideTags.bind(this)));}o.prototype.showTag=function(event){"use strict";var p=event.getTarget(),q=h.hasClass(p,'taggee'),r=h.hasClass(p,"_54ru"),s=null;if(q){s=p.getAttribute('data-tag');}else if(r){var t=k.byTag(p,'a');s=t&&t.getAttribute('data-tag');}if(!s){p=k.byClass(p,'taggee');if(p)s=p.getAttribute('data-tag');}var u=this.version==l.VIEWER_PERMALINK?'perm:tag:'+s:'tag:'+s,v=u&&n(u);if(v){h.addClass(v,'showTag');h.addClass(this.tagBox,'showingTag');}};o.prototype.hideTags=function(){"use strict";h.removeClass(this.tagBox,'showingTag');i.scry(this.tagBox,'div.showTag').forEach(function(p){h.removeClass(p,'showTag');});};o.prototype.destroy=function(){"use strict";for(var p in this.handlers)this.handlers[p].remove();this.subscriptions.forEach(g.unsubscribe.bind(g));};e.exports=o;},null);
__d("legacy:PhotoTags",["PhotoTags"],function(a,b,c,d){b.__markCompiled&&b.__markCompiled();a.PhotoTags=b('PhotoTags');},3);
__d("TagToken",["DOM","Token"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();for(var i in h)if(h.hasOwnProperty(i))k[i]=h[i];var j=h===null?null:h.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=h;function k(l){"use strict";h.call(this,l,'tag');}k.prototype.createElement=function(){"use strict";var l=this.isFreeform(),m=g.create('span',{className:'separator'},', '),n=g.create(l?'span':'a',{className:'taggee','data-tag':this.getValue()},this.getText());if(!l)n.href=this.getInfo().path;return g.create('span',{className:'tagItem'},[m,n]);};e.exports=k;},null);
__d("TagTokenizer",["Arbiter","CSS","DOM","Parent","TagToken","Tokenizer","createObjectFrom","ge","getElementText","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();for(var q in l)if(l.hasOwnProperty(q))s[q]=l[q];var r=l===null?null:l.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=l;function s(t,u,v,w,x){"use strict";l.call(this,v,w,x);g.subscribe('PhotoInlineEditor.CANCEL_INLINE_EDITING',this.updateTokenareaVisibility.bind(this),g.SUBSCRIBE_NEW);this.appphoto=u;g.subscribe(t.getInstance().getEventString('DATA_CHANGE'),this.setup.bind(this),g.SUBSCRIBE_NEW);}s.prototype.setup=function(t,u){"use strict";this.appphoto=u.byapp;this.byowner=u.isowner;return this.reset();};s.prototype.reset=function(){"use strict";var t=this.getTokenElements().map(this.getTokenDataFromTag.bind(this));this.withTagKeys={};var u=this.getWithTagTokenElements().map(function(v){return this._tokenKey(this.getTokenDataFromTag(v));}.bind(this));this.withTagKeys=m(u);return r.reset.call(this,t);};s.prototype.processEvents=function(event,t,u){"use strict";if(j.byClass(t,'remove')){var v=this.getTokenFromElement(u);v=this.addTokenData(v,t);this.removeToken(v);event.kill();}};s.prototype.insertToken=function(t){"use strict";return null;};s.prototype.removeToken=function(t){"use strict";if(this.appphoto){return this.replaceToken(t);}else{this.inform('removeToken',t);g.inform('Form/change',{node:this.element});}};s.prototype.addTokenData=function(t,u){"use strict";if(j.byClass(u,'blockuser'))t.blockUser=true;return t;};s.prototype.getTokenDataFromTag=function(t){"use strict";return {uid:i.find(t,'input').value,text:o(i.find(t,'.taggee'))};};s.prototype.getTokenElementFromTarget=function(t){"use strict";return j.byClass(t,'tagItem');};s.prototype.getTokenElements=function(){"use strict";return i.scry(this.tokenarea,'span.tagItem').filter(this.filterNonTokenElements.bind(this));};s.prototype.getWithTagTokenElements=function(){"use strict";return i.scry(this.tokenarea,'span.withTagItem');};s.prototype.filterNonTokenElements=function(t){"use strict";return !h.hasClass(t,'markasspam')&&!h.hasClass(t,'reported')&&!h.hasClass(t,'withTagItem');};s.prototype.createToken=function(t,u){"use strict";var v=this.getToken(this._tokenKey(t));v=v||new k(t);u&&v.setElement(u);return v;};s.prototype.updateTokenareaVisibility=function(){"use strict";var t=this.getTokenElements().filter(function(w){return h.shown(w);}),u=this.getWithTagTokenElements(),v=i.scry(this.tokenarea,'span.ogTagItem');h.conditionShow(this.tokenarea,t.length!==0||u.length!==0||v.length!==0);};s.prototype.replaceToken=function(t){"use strict";if(!t)return;var u=this.tokens.indexOf(t);if(u<0)return;this.tokens.splice(this.tokens.indexOf(t),1);delete this.unique[this._tokenKey(t.getInfo())];var v=n('tagspam'+t.getValue());v&&i.remove(v);var w=[' [',p._("Tag Removed."),' '];w.push(i.create('a',{onclick:this.markAsSpam.bind(this,t.getValue())},p._("Mark tag as spam")));w.push('] ');var x=i.create('span',{className:'fbPhotosTaglistTag tagItem markasspam',id:'tagspam'+t.getValue()},w);i.replace(t.getElement(),x);this.updateTokenarea();this.inform('removeToken',t);g.inform('Form/change',{node:this.element});};s.prototype.markAsSpam=function(t){"use strict";var u=n('tagspam'+t),v=[' [',p._("Tag Reported"),'] '],w=i.create('span',{className:'fbPhotosTaglistTag tagItem reported',id:'tagspam'+t},v);i.replace(u,w);this.inform('markTagAsSpam',t);};e.exports=s;},null);
__d("TagTypeaheadView",["AsyncRequest","ContextualTypeaheadView","CSS","DOM","Parent","FamilyTaggingConfig"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();for(var m in h)if(h.hasOwnProperty(m))o[m]=h[m];var n=h===null?null:h.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=h;function o(p,q){"use strict";h.call(this,p,q);this.hintText=q.hintText;this.userEd=q.userEd;this.origAutoSelect=q.autoSelect;this.setSuggestions(q.suggestions);}o.prototype.init=function(){"use strict";i.addClass(this.element,'uiTagTypeaheadView');n.init.call(this);};o.prototype.buildResults=function(p){"use strict";if(!this.value&&this.hintText)p.unshift({subtext:this.hintText,type:'hintText'});if(this.userEd){new g().setURI('/ajax/fof/user_education.php').setData({increment:1}).send();p.unshift({subtext:this.userEd,type:'userEdText'});}if(l.gk){var q=[],r=[];for(var s=0;s<p.length;s++)if(p[s].type!=='family_tags'&&p[s].index!=-1000&&p[s].type!=='hintText'){q.push(p[s]);}else r.push(p[s]);p=r.concat(q);n.updateResults.call(this,p);}var t=n.buildResults.call(this,p);if(this.userEd)p.shift();if(!this.value)p.shift();return t;};o.prototype.show=function(){"use strict";var p=j.scry(this.context,'.typeaheadBackdrop');if(p.length>0)i.addClass(p[0],'resultsPresent');return n.show.call(this);};o.prototype.hide=function(){"use strict";var p=j.scry(this.context,'.typeaheadBackdrop');if(p.length>0)i.removeClass(p[0],'resultsPresent');return n.hide.call(this);};o.prototype.render=function(p,q,r){"use strict";this.autoSelect=this.origAutoSelect&&p.length;this.disableAutoSelect=p.length===0;n.render.call(this,p,q,r);};o.prototype.getItems=function(){"use strict";var p=n.getItems.call(this);if(!this.value)p.shift();if(this.userEd)p.shift();return p;};o.prototype.getSuggestions=function(){"use strict";return this.suggestions;};o.prototype.setSuggestions=function(p){"use strict";this.suggestions=p?p.map(String):[];this.visible=!!this.suggestions.length;};o.prototype.addSuggestion=function(p){"use strict";this.suggestions.unshift(p);};o.prototype.addTypeaheadFlip=function(p){"use strict";i.addClass(this.element,p);};o.prototype.removeTypeaheadFlip=function(p){"use strict";i.removeClass(this.element,p);};o.prototype.getContext=function(){"use strict";var p=k.byClass(this.element,'typeaheadContainer');if(p){return p;}else return n.getContext.call(this);};e.exports=o;},null);
__d("MakeProfilePicInit",["ProfilePicCropViewerInit","URI"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={handleOptimus:function(j,k,l){l.prevent();var m=new h(k.getAttribute('ajaxify')||k.href).getQueryData();g.loadID(m.fbid,m.profile_id,{source:m.pp_source});}};e.exports=i;},null);
__d("FreeformTokenizerBehavior",["Event","Input","Keys"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(k,l){var m=l.matcher&&new RegExp(l.matcher,'i'),n=l.splitter&&new RegExp(l.splitter),o=l.tokenize_on_blur!==false,p=l.tokenize_on_paste!==false,q=l.split_on_check===true,r=l.select_on_comma!==false,s=l.select_on_space===true,t=l.never_submit===true;function u(event){var v=h.getValue(k.getInput()).trim();if(n&&event&&event.type=='paste'){v=v.split(n);}else if(n&&q){v=v.split(n);}else v=[v];var w=false;for(var x=0;x<v.length;x++){var y=v[x].trim();if(y&&(!m||m.test(y))){var z={uid:y,text:y,freeform:true};k.addToken(k.createToken(z));w=true;}}if(event&&w){k.getTypeahead().getCore().afterSelect();event.kill();}}k.subscribe('keydown',function(v,w){var event=w.event,x=g.getKeyCode(event);if(x==i.RETURN||(r&&x==i.COMMA)||(s&&x==i.SPACE)){var y=k.getTypeahead().getView();if(y.getSelection()){y.select();event.kill();}else u(event);}if(x==i.RETURN&&t)event.kill();});k.subscribe('paste',function(v,w){if(p)setTimeout(u.bind(null,w.event),20);});k.subscribe('blur',function(v,w){if(o)u();k.getTypeahead().getCore().reset();});}e.exports=j;},null);
__d("TypeaheadHintText",["emptyFunction"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(i){"use strict";this._typeahead=i;}h.prototype.enable=function(){"use strict";this._typeahead.getCore().resetOnKeyup=false;};Object.assign(h.prototype,{disable:g});e.exports=h;},null);
__d("legacy:HintTextTypeaheadBehavior",["TypeaheadHintText"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.hintText=function(h){h.enableBehavior(g);};},3);
__d("VideoChainingToken",["Base64"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(i){"use strict";this.$VideoChainingToken0=i;}h.prototype.decode=function(){"use strict";return JSON.parse(g.decode(this.$VideoChainingToken0));};e.exports=h;},null);