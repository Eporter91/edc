/*!CK:1327780624!*//*1433746390,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["\/aCUp"]); }

__d("P2PSendMoneyButtonImpl.react",["CurrentEnvironment","ImmutableObject","P2PAbstractSendMoneyButton.react","P2PActions","P2PErrorDialog.react","P2PGroupSendDialog.react","P2PGroupSendReceiptDialog.react","P2PPasswordProtectionNUXDialog.react","P2PPasswordProtectionStatusTypes","P2PSendMoneyDialog.react","P2PSendMoneyDialogStore","P2PSendMoneySuccessDialog.react","P2PTransferParam","P2PTransferStore","P2PTransferRiskResult","P2PUnderManualReviewDialog.react","P2PUserEligibilityStore","P2PVerificationFlowHelper","React","ReactLayeredComponentMixin","emptyFunction","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){b.__markCompiled&&b.__markCompiled();'use strict';var ca=y,da=ca.PropTypes,ea=y.createClass({displayName:"P2PSendMoneyButtonImpl",mixins:[z],propTypes:{isNewEmptyLocalThread:da.bool,isGroupChat:da.bool,onTrigger:da.func,participants:da.arrayOf(da.object).isRequired,threadID:da.string,threadFBID:da.string},getDefaultProps:function(){return {onTrigger:aa};},getInitialState:function(){return {amount:'',groupThreadFBID:'',sendMoneyDialogShown:false,participants:this.props.participants};},componentDidMount:function(){this.sendMoneyDialogStoreSub=q.addListener('change',this.onSendMoneyDialogStoreChange);this.userEligibilityStoreSub=w.addListener('change',this.onUserEligibilityChange);this.setEligibilityState();this.setSendMoneyDialogState();},componentWillUnmount:function(){if(this.sendMoneyDialogStoreSub){this.sendMoneyDialogStoreSub.remove();this.sendMoneyDialogStoreSub=null;}if(this.userEligibilityStoreSub){this.userEligibilityStoreSub.remove();this.userEligibilityStoreSub=null;}},componentWillReceiveProps:function(fa){if(fa.participants.length!==this.props.participants.length||fa.threadID!==this.props.threadID)this.setState({participants:fa.participants},function(){this.setEligibilityState();this.setSendMoneyDialogState();}.bind(this));},setEligibilityState:function(){var fa,ga,ha=this.state.participants;if(!ha.length)return;fa=ha.map(function(ja){return ja.userID;});ga=w.getEligibilityByUserIDs(fa);for(var ia=0;ia<ha.length;ia++)ha[ia]=h.set(ha[ia],{p2p_eligible:ga[ha[ia].userID]});this.setState({participants:ha});},onSendMoneyDialogStoreChange:function(){this.setSendMoneyDialogState();},onUserEligibilityChange:function(){this.setEligibilityState();},setSendMoneyDialogState:function(){var fa;if(!this.canShowSendMoneyDialog())return false;fa=this.props.threadID?q.getStateByThreadID(this.props.threadID):null;if(fa)this.setState({sendMoneyDialogShown:fa.isOpen,amount:fa.amount,groupThreadFBID:fa.groupThreadFBID,groupSendReceiptDetails:fa.groupSendReceiptDetails});},canShowSendMoneyDialog:function(){if(!this.state.participants.length)return false;if(this.getRecipient()&&!this.isRecipientEligible())return false;return true;},originalCreateTransactionResponse:null,_onButtonClick:function(){this.canShowSendMoneyDialog()&&this.showSendMoneyDialog();},hideSendMoneyDialog:function(){j.chatSendViewClosed({threadID:this.props.threadID});},showSendMoneyDialog:function(){j.chatSendViewOpened({threadID:this.props.threadID});},_handleDialogToggle:function(fa){if(!fa){this.hideSendMoneyDialog();}else this.showSendMoneyDialog();},handleOnSendSuccess:function(fa){this.hideSendMoneyDialog();var ga=fa[s.RISK_RESULT];this.originalCreateTransactionResponse=fa;if(ga===u.REQUIRE_VERIFICATION){x.startVerificationFlow(fa.id,true,this.handlePostSendSteps);}else if(ga===u.UNDER_MANUAL_REVIEW){this.showUnderManualReviewDialog();}else this.handlePostSendSteps();},handlePostSendSteps:function(){var fa=this.originalCreateTransactionResponse,ga=fa.passwordProtection===o.NOT_SET;if(fa.isFirstSend){this._passwordNUXPending=ga;this.showSendSuccessDialog();}else if(ga){this.showPasswordProtectionDialog();}else j.hideDialog();this.originalCreateTransactionResponse=null;this.props.onTrigger();},handleConfirmationOKClick:function(){if(this._passwordNUXPending){this._passwordNUXPending=false;this.showPasswordProtectionDialog();}else j.hideDialog();},handleSendError:function(fa){this.showErrorDialog(fa);},getMoneyButtonNode:function(){return y.findDOMNode(this.refs.p2pSendMoneyButton);},getRecipient:function(){if(!this.props.isGroupChat)return this.state.participants[0];return null;},isRecipientEligible:function(){var fa=this.getRecipient();if(!fa)return false;return !!(fa.p2p_eligible||t.hasReceivedFromSender(fa.userID));},showErrorDialog:function(fa){var ga=ba._("Problem Sending Money");j.showDialog(k,{error:fa,onOKClick:j.hideDialog,title:ga});},showPasswordProtectionDialog:function(){j.showDialog(n,{onComplete:j.hideDialog});},showSendSuccessDialog:function(){j.showDialog(r,{onClose:this.handleConfirmationOKClick});},showUnderManualReviewDialog:function(){j.showDialog(v,{onClose:this.handlePostSendSteps});},renderLayers:function(){var fa={},ga='USD',ha='$';if(this.state.sendMoneyDialogShown)if(this.state.groupSendReceiptDetails){fa.groupSendReceiptDetailsDialog=y.createElement(m,{context:this.getMoneyButtonNode(),currency:ga,groupSendReceiptDetails:this.state.groupSendReceiptDetails,onToggle:this._handleDialogToggle,threadFBID:this.props.threadFBID,threadID:this.props.threadID});}else if(this.props.isGroupChat){fa.groupSendMoneyDialog=y.createElement(l,{amount:this.state.amount,context:this.getMoneyButtonNode(),currency:ga,onToggle:this._handleDialogToggle,participants:this.state.participants,threadFBID:this.props.threadFBID});}else fa.sendMoneyDialog=y.createElement(p,{amount:this.state.amount,context:this.getMoneyButtonNode(),currency:ga,currencySymbol:ha,groupThreadFBID:this.state.groupThreadFBID,onToggle:this._handleDialogToggle,onError:this.handleSendError,onSendSuccess:this.handleOnSendSuccess,receiver:this.getRecipient(),ref:'send_money_dialog'});return fa;},render:function(){var fa=this.getRecipient();if(this.props.isNewEmptyLocalThread&&this.state.participants.length>1)return null;return (y.createElement(i,{isDialogOpen:this.state.sendMoneyDialogShown,isDisabled:!!(fa&&!this.isRecipientEligible()),isMessenger:!!g.messengerdotcom,onClick:this._onButtonClick,recipientName:fa&&fa.short_name,ref:"p2pSendMoneyButton"}));}});e.exports=ea;},null);